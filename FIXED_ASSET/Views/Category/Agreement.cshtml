@using System.Data
@using System.Collections
@using FIXED_ASSET.DTO
@using System.Data
@using System.Collections

@{
    ViewBag.Title = "Agreement";
    Layout = "~/Views/Shared/_Layout.cshtml";
    List<ViewManufactureDTO> ManufactureGridList = new List<ViewManufactureDTO>();


    if (ViewBag.ManufactureGridList != null)
    {
        ManufactureGridList = ViewBag.ManufactureGridList;
    }
}


<link href="~/Content/css/select2.css" rel="stylesheet" />
<script src="~/Content/js/select2.full.min.js"></script>
<link href="~/Content/css/dataTables.bootstrap.min.css" rel="stylesheet" />
<script src="~/Content/js/jquery.dataTables.min.js"></script>
<script src="~/Content/js/dataTables.bootstrap.min.js"></script>

<style type="text/css">

    div.addnew {
        display: none
    }

    html {
        overflow-y: scroll;
    }
</style>
<!-- Content Header (Page header) -->
<section class="content-header">
    <h1>
        @ViewBag.Title
        <small>Control panel</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Agreement</li>
    </ol>
</section>

<!-- Main content -->
<section class="content">
    <!-- Default box -->
    <div class="center-block col-md-6" style="float: none;">    </div>
    <div class="box box-primary addnew">
        <div class="box-header with-border">
            <h3 class="box-title">@ViewBag.Title</h3>
            <div class="box-tools pull-right">
                <button class="btn btn-primary bg-blue-gradient hide-form">Hide</button>
            </div>
        </div>

        <form role="form"></form>
        <div class="box-body">
            <div class="panel panel-primary col-md-12 center-block" style="float: none;">
                <div class="panel-body">
                    <fieldset>
                        <legend>Agreement </legend>
                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="ProjectList">Project/Outlet</label>
                                    <select type="text" class="form-control select2 " style="width:315px;" id="ProjectList"></select>
                                    @*<select type="text" class="form-control select2 " style="width:315px;" id="ProjectList"></select>*@
                                </div>
                                <div class="col-md-4">
                                    <label for="UnitList">Unit</label>
                                    <input type="hidden" class="form-control" id="UnitList_edit" placeholder="">
                                    <select type="text" class="form-control select2 " style="width:315px;" id="UnitList"></select>
                                </div>
                                <div class="col-md-4">
                                    <label for="Shop No">Agreement ID</label>
                                    <input type="text" class="form-control col-sm-4" id="agreementId" placeholder="Agreement ID">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="contarctType">Contract Type</label>
                                    <input type="text" class="form-control col-sm-4" id="contractType" placeholder="Contract Type">
                                    @*<select class="form-control select2" id="contarctType" style="width:315px">
                                            <option selected> Select </option>
                                            <option value="1">Factory</option>
                                            <option value="2">Warehouse</option>
                                            <option value="3">Store</option>
                                        </select>*@
                                </div>
                                <div class="col-md-4">
                                    <label for="uRL"> Start Date of Agreement</label>
                                    <div class="input-group date" data-provide="datepicker">
                                        <input type="text" data-date-format="mm/dd/yyyy" id="start_Date_of_Agreement" class="form-control datepicker" placeholder="Select Date">
                                        <div class="input-group-addon">
                                            <span class="glyphicon glyphicon-th"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label for="countryList">Tenor(Year)</label>
                                    <input type="text" class="form-control" id="Tenor" placeholder="Tenor(Year)">
                                </div>

                            </div>
                        </div>

                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="uRL"> End Date of Agreement</label>
                                    <input type="text" class="form-control" id="end_Date_of_Agreement" placeholder="">
                                    @*<input type="text" class="form-control" id="end_Date_of_Agreement" placeholder="Advance Amount">*@
                                    @*<div class="input-group date" data-provide="datepicker">
                                            <input type="text" data-date-format="mm/dd/yyyy" id="end_Date_of_Agreement" class="form-control datepicker" placeholder="End Date of Agreement">
                                            <div class="input-group-addon">
                                                <span class="glyphicon glyphicon-th"></span>
                                            </div>
                                        </div>*@
                                </div>
                                <div class="col-md-4">
                                    <label for="uRL">Advance Amount</label>
                                    <input type="text" class="form-control" id="advance_Amount" placeholder="Advance Amount">
                                </div>
                                <div class="col-md-4">
                                    <label for="rent_Pay">Rent Amount</label>
                                    <input type="text" class="form-control" id="rent_Pay" placeholder="Rent Amount">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="monthlyRentTaxBased">Monthly Rent Tax Based </label>
                                    <input type="text" class="form-control" id="monthlyRentTaxBased" value="0" placeholder="Monthly Rent Tax Based">
                                </div>
                                <div class="col-md-4">
                                    <label for="Aggrement_Hand_Over_Date"> Agrement Hand Over Date </label>
                                    <div class="input-group date" data-provide="datepicker">
                                        <input type="text" data-date-format="mm/dd/yyyy" id="agrement_Hand_Over_Date" class="form-control datepicker" placeholder="---Select Date---">
                                        <div class="input-group-addon">
                                            <span class="glyphicon glyphicon-th"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label for="Actual_Hand_Over_Date">Actual Hand Over Date </label>
                                    <div class="input-group date" data-provide="datepicker">
                                        <input type="text" data-date-format="mm/dd/yyyy" id="actual_Hand_Over_Date" class="form-control datepicker" placeholder="---Select Date---">
                                        <div class="input-group-addon">
                                            <span class="glyphicon glyphicon-th"></span>
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>
                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="Rent Count">Rent Count</label>
                                    <input type="text" class="form-control" id="rent_Count" value="0" placeholder="Rent Count">
                                </div>
                                <div class="col-md-4">
                                    <label for="actual_Rent_Start_Date">Actual Rent Start Date </label>
                                    <div class="input-group date" data-provide="datepicker">
                                        <input type="text" data-date-format="mm/dd/yyyy" id="actual_Rent_Start_Date" class="form-control datepicker" placeholder="---Select Date---">
                                        <div class="input-group-addon">
                                            <span class="glyphicon glyphicon-th"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label for="Actual_Rent_End_Date">Actual Rent End Date </label>
                                    <div class="input-group date" data-provide="datepicker">
                                        <input type="text" data-date-format="mm/dd/yyyy" id="actual_Rent_End_Date" class="form-control datepicker" placeholder="---Select Date---">
                                        <div class="input-group-addon">
                                            <span class="glyphicon glyphicon-th"></span>
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>
                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="Actual_Advance_Start_Date">Actual Advance Start Date</label>
                                    <div class="input-group date" data-provide="datepicker">
                                        <input type="text" data-date-format="mm/dd/yyyy" id="actual_Advance_Start_Date" class="form-control datepicker" placeholder="---Select Date---">
                                        <div class="input-group-addon">
                                            <span class="glyphicon glyphicon-th"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label for="Advance_Adjustment_Amount">Advance Adjustment Amount</label>
                                    <input type="text" class="form-control" id="advance_Adjustment_Amount" value="0" placeholder="Advance adjustment Amount">
                                </div>
                                <div class="col-md-4">
                                    <label for="Notice_Period">Notice Period(Days)</label>
                                    <input type="text" class="form-control" id="notice_Period" value="0" placeholder="Notice Period(Days)">
                                </div>


                            </div>
                        </div>
                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="AIT_Paid_By">AIT Paid By</label>
                                    <select id="aIT_Paid_By" class="form-control" name="active_status">
                                        <option value="1">Landlord</option>
                                        <option value="2">Company</option>
                                    </select>
                                    @*<input type="text" class="form-control" id="aIT_Paid_By" placeholder="AIT Paid By">*@
                                </div>
                                <div class="col-md-4">
                                    <label for="Rent_Increment">Rent Increment %</label>
                                    <input type="text" class="form-control" id="rent_Increment" value="0" placeholder="Rent Increment %">
                                </div>
                                <div class="col-md-4">
                                    <label for="Increment_Intervale">Increment Intervale(Years)</label>
                                    <input type="text" class="form-control" id="increment_Intervale" value="0" placeholder="Increment Intervale">
                                </div>

                            </div>
                        </div>
                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="Payment_Term">Payment Term</label>
                                    <input type="text" class="form-control" id="payment_Term" placeholder="Payment Term">
                                </div>

                                <div class="col-md-4">
                                    <label for="Rent_Pay_Date">Rent Pay Day</label>
                                    <select class="form-control" id="Rent_Pay_Date" placeholder="---select Day---"></select>
                                </div>
                                <div class="col-md-4">
                                    <label for="">Status</label>
                                    <select id="active_status" class="form-control" name="active_status">
                                        <option value="true">Active</option>
                                        <option value="false">InActive</option>
                                    </select>
                                </div>

                            </div>
                        </div>

                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="remRent">Breaking Month Rent </label>
                                    <input type="text" class="form-control" id="remRent" value="0" placeholder="Breaking Month Rent">
                                </div>
                                <div class="col-md-4">
                                    <label for="remTax">Breaking Month Tax </label>
                                    <input type="text" class="form-control" id="remTax" value="0" placeholder="Breaking Month Tax">
                                </div>
                            </div>
                        </div>
                        <div class="row">

                        </div>
                        <div class="col-md-12">
                            <div class="box-body table-responsive no-padding">
                                <table id="slotdatatable" class="table table-bordered table-striped compact hover" cellspacing="0" width="100%">
                                    <thead>
                                        <tr>
                                            <th id="Start_Date">Start Date</th>
                                            <th id="End_Date">End Date</th>
                                            <th id="Increment_Amount">Basic Rent</th>
                                            <th id="Increment_Amount">Monthly Rent Tax Base</th>

                                        </tr>
                                        @*<tr>
                                                <td style="width:300px" data-bind="First_start_date">

                                                </td>
                                            </tr>*@

                                    </thead>
                                    <tbody id="rentalDate">
                                    </tbody>

                                </table>

                            </div>
                            <!-- /.box-body -->
                        </div>

                        <div class="text-right">
                            <button type="submit" class="btn btn-primary" id="submitAgreement" onclick="addcat();">Submit</button>
                            <button type="submit" class="btn btn-primary" id="generateAgreement">Generate</button>
                            <button type="submit" class="btn btn-info" id="submitAgreementIncrement">Increment</button>
                            @*<button type="submit" class="btn btn-primary" id="generateAgreementDetails">Details</button>*@
                            <button class="btn btn-sm btn-primary " id="updateAgreement">
                                <i class="ace-icon fa fa-check"></i> Update
                            </button>
                        </div>
                    </fieldset>
                </div>
            </div>

        </div>

    </div>

    <!-- /.box -->
    <!-- Default box -->
    <div class="box box-primary">
        <div class="box-header with-border">
            <h3 class="box-title">List All Agreement</h3>
            <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool show-form text-info bg-blue-gradient"><i class="fa fa-plus"></i>Add New</button>
            </div>
        </div>
        <div class="col-md-12">
            <div class="box-body table-responsive no-padding">
                <table id="datatable" class="table table-bordered table-striped compact hover" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            @*<th>SL</th>*@
                            <th>Agreement ID</th>
                            <th class="hidden"></th>
                            <th>Project/Outlet</th>
                            <th class="hidden"></th>
                            <th>Unit</th>
                            <th>Contract Type</th>
                            <th>Start Date of Agreement</th>
                            <th>Tenor</th>
                            <th>End Date of Agreement</th>
                            <th>Advance Amount</th>
                            @*<th>Rent Pay</th>*@
                            <th>Agrement Hand Over Date</th>
                            <th>Actual Hand Over Date</th>
                            <th>Status</th>
                            <th style="font-size:15px;width:100px;">Actions</th>
                        </tr>
                    </thead>

                </table>

            </div>
            <!-- /.box-body -->
        </div>
        <div class="box-footer">
            Footer
        </div>
        <!-- /.box-footer-->
    </div>
    <!-- /.box -->

</section>
<!-- /.content -->
<link href="../../dist/css/bootstrap-datepicker.min.css" rel="stylesheet" />
<script src="../../dist/js/bootstrap-datepicker.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
@*<script src="http://cdn.datatables.net/plug-ins/1.10.19/sorting/datetime-moment.js"></script>*@
<script>

    $(document).ready(function () {
        $('.select2').select2();

        $.fn.datepicker.defaults.autoclose = true;
        //$('#Rent_Pay_Date').datepicker( {
        //changeMonth: false,
        //changeYear: false,
        //showButtonPanel: true,
        //dateFormat: 'dd MM'
        //});
        var days = ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", "31"];

        for (i = 0; i <= days.length; i++) {

            $('#Rent_Pay_Date').append($('<option />').html(days[i]));

        }

        //    $("#Rent_Pay_Date").datepicker( {
        //   changeYear: false,
        //  dateFormat: 'MM-dd',
        //   }).focus(function () {
        //$(".ui-datepicker-year").hide();
        //  })
        //        $(".Rent_Pay_Date").datepicker( {
        //            changeYear: false,
        //             changeMonth: false,
        //        dateFormat: 'MM-dd',
        //       }).focus(function () {
        //       $(".ui-datepicker-year").hide();
        //});
        //  $("#start_Date_of_Agreement").datepicker("setDate", new Date());
        // $("#end_Date_of_Agreement").datepicker("setDate", new Date());
        //("#agrement_Hand_Over_Date").datepicker("setDate", new Date());
        //("#actual_Hand_Over_Date").datepicker("setDate", new Date());
        // $("#actual_Rent_Start_Date").datepicker("setDate", new Date());
        // $("#actual_Rent_End_Date").datepicker("setDate", new Date());
        //$("#actual_Advance_Start_Date").datepicker("setDate", new Date());
        //$("#Rent_Pay_Date").datepicker("setDate", new Date());
        ProjectList();
        // Unitist();
        $('.addnew').hide();
        $('.show-form').click(function () {
            $('.addnew').show();
            $('.show-form').hide();
            $('#updateAgreement').hide();
            $('#generateAgreement').hide()
            $('#submitAgreementIncrement').hide();
            $('#slotdatatable').hide();
        });
        $('.hide-form').click(function () {
            $('.addnew').hide();
            $('.show-form').show();
        });

        getData();
        Unitist(0);

    });

    //$("#advance_Amount,#advance_Adjustment_Amount").change(function () {
    //    var advance_Amount = parseInt($('#advance_Amount').val());
    //    var advance_Adjustment_Amount =parseInt($('#advance_Adjustment_Amount').val());
    //    var balance_advance = (advance_Amount-advance_Adjustment_Amount);
    //    //alert(balance_advance);
    //    $('#balanceAdvance ').val(balance_advance)
    //});
    $("#actual_Hand_Over_Date,#rent_Count").change(function () {
        var actual_Hand_Over_Date = $('#actual_Hand_Over_Date').val();
        // var actual_Hand_Over_Date = new Date(actual_Hand_Over_Date);
        var rent_Count = parseInt($('#rent_Count ').val());
        // var rent_Count1 = today.plus(rent_Count, ChronoUnit.DAYS);

        //var yyyy = parseInt((actual_Hand_Over_Date.getFullYear()).toString());
        //var mm = (actual_Hand_Over_Date.getMonth() + 1).toString();
        //var dd = parseInt(actual_Hand_Over_Date.getDate()+ rent_Count).toString();

        //end_Date_of_Agreement = start_Date_of_Agreement.setYear(start_Date_of_Agreement.getYear() + Tenor);
        //actual_Rent_Start_Date = (mm + "/" + dd + "/ " + yyyy);
        // $('#actual_Rent_Start_Date ').val(actual_Rent_Start_Date)-1

        $.ajax({
            type: "POST",
            url: "/AssetCategory/GetRentStartDate",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify({
                //  obj: asd
                actual_Hand_Over_Date: actual_Hand_Over_Date,
                rent_Count: rent_Count

            }),
            success: function (response) {

                //  console.log(response);
                console.log(response.data);
                // $("#actual_Rent_End_Date").val(response.data[0].DateAdd);
                //  $("#end_Date_of_Agreement").show();
                $("#actual_Rent_Start_Date").val(response.data[0].DateAdd);
                // alert(response.data[0].DateAdd);
                //  alert(response.data[0]["DateAdd"]);
                abc();
                BRentPay();


            }
        })
    });

    function abc() {
        var actual_Rent_Start_Date = $('#actual_Rent_Start_Date').val();
        var Tenor = parseInt($('#Tenor ').val());

        $.ajax({
            type: "POST",
            url: "/AssetCategory/GetEndOfRent",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify({
                //  obj: asd
                actual_Rent_Start_Date: actual_Rent_Start_Date,
                Tenor: Tenor

            }),
            success: function (response) {

                //  console.log(response);
                console.log(response.data);

                //  $("#end_Date_of_Agreement").show();
                $("#actual_Rent_End_Date").val(response.data[0].DateAdd);
                // alert(response.data[0].DateAdd);
                //  alert(response.data[0]["DateAdd"]);



            }
        });
    };

    function BRentPay() {

        var leaseExpiry = $('#actual_Rent_Start_Date').val();
        var leaseExpiry = new Date(leaseExpiry);
        var yyyy = parseInt((leaseExpiry.getFullYear()).toString());
        var mm = (leaseExpiry.getMonth() + 1).toString();
        var dd = parseInt(leaseExpiry.getDate()).toString();

        var n = new Date(yyyy, mm, 0);
        // alert(n);

        // var ldd = leaseExpiry.substr(0, 2);
        // ldd = parseInt(ldd, 10);
        // var lmm = leaseExpiry.substr(3, 2);
        // lmm = parseInt(lmm, 10);
        // var lyyyy = leaseExpiry.substr(6, 4);
        // lyyyy = parseInt(lyyyy, 10);


        // var d = new Date(lyyyy, ldd, 0);
        //alert(d);
        var Cdd = n.getDate();//last day of month
        var RDD = Cdd - dd
        // alert(RDD);
        var rent_Pay = $('#rent_Pay').val();
        var dailyRate = (rent_Pay) / Cdd;
        // alert(dailyRate);
        var monthlyRentTaxBased = ($('#monthlyRentTaxBased ').val());
        dailyTax = (monthlyRentTaxBased) / Cdd;

        var balance = (dailyRate * RDD);
        var onedayadd = Math.round(balance + dailyRate)

        var taxbalance = (dailyTax * RDD);
        var onedayaddTax = Math.round(taxbalance + dailyTax)
        // alert(onedayadd)
        $('#remRent ').val(onedayadd.toFixed(2))
        $('#remTax ').val(onedayaddTax.toFixed(2))
        // remRent.val(balance.toFixed(2));
    };
    function BRentTax() {

        var leaseExpiry = $('#actual_Rent_Start_Date').val();
        var leaseExpiry = new Date(leaseExpiry);
        var yyyy = parseInt((leaseExpiry.getFullYear()).toString());
        var mm = (leaseExpiry.getMonth() + 1).toString();
        var dd = parseInt(leaseExpiry.getDate()).toString();

        var n = new Date(yyyy, mm, 0);

        var Cdd = n.getDate();//last day of month
        var RDD = Cdd - dd

        var monthlyRentTaxBased = ($('#monthlyRentTaxBased ').val());
        dailyTax = (monthlyRentTaxBased) / Cdd;

        var taxbalance = (dailyTax * RDD);
        var onedayaddTax = Math.round(taxbalance + dailyTax)
        $('#remTax ').val(onedayaddTax.toFixed(2))

    };



    $("#actual_Rent_Start_Date,#Tenor,#increment_Intervale,#rent_Increment").change(function () {
        var leaseExpiry = $('#actual_Rent_Start_Date').val();
        var Tenor = parseInt($('#Tenor ').val());
        var increment_Intervale = parseInt($('#increment_Intervale ').val());
        // var rent_Pay = parseInt($('#rent_Pay ').val());
        var rent_Increment = parseInt($('#rent_Increment ').val());
        var ldd = leaseExpiry.substr(0, 2);
        ldd = parseInt(ldd, 10);
        var lmm = leaseExpiry.substr(3, 2);
        lmm = parseInt(lmm, 10);
        var lyyyy = leaseExpiry.substr(6, 4);
        lyyyy = parseInt(lyyyy, 10);
        var first_day_of_next_month = new Date(lyyyy, ldd, 1);//sep 1 2020
        var last_day_of_month = new Date(lyyyy, ldd, 0);//Augst 2020
        // alert(last_day_of_month);
        // alert(first_day_of_next_month);
        //   var lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
        // var yyyy = parseInt((first_day_of_next_month.getFullYear()+1).toString());
        //var mm = parseInt(((first_day_of_next_month.getMonth()+1))-1).toString();
        //var dd =(parseInt(first_day_of_next_month.getDate()).toString());
        //    var one_year_increment_Date =new Date(yyyy, mm, 0);
        //   alert(one_year_increment_Date);
        //  alert(first_day_of_next_month);
        var slot = parseInt(Tenor / increment_Intervale);
        var rent_slot_amount = rent_Pay + ((rent_Increment * rent_Pay) / 100);
        var rent_slot_increment_amount = ((rent_Increment * rent_Pay) / 100);
        // console.log(slot);
        var a = parseInt((first_day_of_next_month.getFullYear()).toString())

        //var a = parseInt(first_day_of_next_month.getFullYear()).toString();
        for (i = 0; i <= slot; i++) {
            // console.log(slot);
            var yyyy = parseInt((a).toString());
            a = yyyy + slot;
            //  alert(a);
            //  var yyyy = parseInt((first_day_of_next_month.getFullYear()+[i]).toString());
            var mm = (first_day_of_next_month.getMonth() + 1).toString();
            var dd = first_day_of_next_month.getDate().toString();
            next_Rent_intervale_Date = (mm + "/" + dd + "/ " + a);
            //alert(next_Rent_intervale_Date);
        }

        var l = parseInt((last_day_of_month.getFullYear()).toString())

        for (i = 0; i <= slot; i++) {

            var yyyy = parseInt((l).toString());
            l = yyyy + slot;

            var mm = ((last_day_of_month.getMonth() + 1)).toString();
            var dd = last_day_of_month.getDate().toString();
            last_day_ofnext_Rent_intervale_Date = (mm + "/" + dd + "/ " + l);
            // alert(last_day_ofnext_Rent_intervale_Date);
            //alert(next_Rent_intervale_Date);
        }
        var b = parseInt($('#rent_Pay ').val());
        var c = parseInt((rent_Increment * b) / 100);
        for (var i = 0; i <= slot; i++) {
            var increment_rent = (b + c);
            b = increment_rent;
            // alert( b);
        }

    });
    //calculates the remaining rent left to pay for terminated leases
    $("#rent_Pay,#monthlyRentTaxBased ").change(function () {

        var leaseExpiry = $('#actual_Rent_Start_Date').val();
        var ldd = leaseExpiry.substr(0, 2);
        ldd = parseInt(ldd, 10);
        var lmm = leaseExpiry.substr(3, 2);
        lmm = parseInt(lmm, 10);
        var lyyyy = leaseExpiry.substr(6, 4);
        lyyyy = parseInt(lyyyy, 10);


        var d = new Date(lyyyy, ldd, 0);
        // alert(d)
        var Cdd = d.getDate();//last day of month
        // alert(Cdd);
        var RDD = Cdd - lmm
        var rent_Pay = $('#rent_Pay').val();
        var dailyRate = (rent_Pay) / Cdd;
        //alert(RDD);
        var monthlyRentTaxBased = ($('#monthlyRentTaxBased ').val());
        dailyTax = (monthlyRentTaxBased) / Cdd;

        var balance = (dailyRate * RDD);
        var onedayadd = Math.round(balance + dailyRate)

        var taxbalance = (dailyTax * RDD);
        var onedayaddTax = Math.round(taxbalance + dailyTax)
        //  alert(onedayadd)
        $('#remRent ').val(onedayadd.toFixed(2))
        $('#remTax ').val(onedayaddTax.toFixed(2))
        // remRent.val(balance.toFixed(2));
    });

    $("#start_Date_of_Agreement,#Tenor").change(function () {
        var start_Date_of_Agreement = $('#start_Date_of_Agreement').val();
        //var start_Date_of_Agreement = new Date(start_Date_of_Agreement);
        var Tenor = parseInt($('#Tenor ').val());
        $.ajax({
            type: "POST",
            url: "/AssetCategory/GetEndOfAgreement",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify({
                //  obj: asd
                start_Date_of_Agreement: start_Date_of_Agreement,
                Tenor: Tenor

            }),
            success: function (response) {

                //  console.log(response);
                console.log(response.data);

                //  $("#end_Date_of_Agreement").show();
                $("#end_Date_of_Agreement").val(response.data[0].DateAdd);
                // alert(response.data[0].DateAdd);
                //  alert(response.data[0]["DateAdd"]);



            }
        })
        //var yyyy = parseInt((start_Date_of_Agreement.getFullYear() + Tenor).toString());
        //var mm = (start_Date_of_Agreement.getMonth()).toString();
        //var dd = (start_Date_of_Agreement.getDate()).toString();

        //end_Date_of_Agreement = start_Date_of_Agreement.setYear(start_Date_of_Agreement.getYear() + Tenor);
        //  end_Date_of_Agreement = (mm + "/" + (dd )+ "/ " + yyyy);

    });
    //$("#actual_Rent_Start_Date").change(function () {
    //    var actual_Rent_Start_Date = $('#actual_Rent_Start_Date').val();
    //    //var actual_Rent_Start_Date = new Date(actual_Rent_Start_Date);
    //    var Tenor = parseInt($('#Tenor ').val());

    //    //var yyyy = parseInt((actual_Rent_Start_Date.getFullYear() + Tenor).toString());
    //    //var mm = (actual_Rent_Start_Date.getMonth() + 1).toString();
    //    //var dd = actual_Rent_Start_Date.getDate().toString();

    //    //end_Date_of_Agreement = start_Date_of_Agreement.setYear(start_Date_of_Agreement.getYear() + Tenor);
    //    //actual_Rent_End_Date = (mm + "/" + dd + "/" + yyyy);
    //    //$('#actual_Rent_End_Date ').val(actual_Rent_End_Date)
    //    $.ajax({
    //        type: "POST",
    //        url: "/AssetCategory/GetEndOfRent",
    //        contentType: "application/json; charset=utf-8",
    //        dataType: "json",
    //        data: JSON.stringify({
    //            //  obj: asd
    //            actual_Rent_Start_Date: actual_Rent_Start_Date,
    //            Tenor: Tenor

    //        }),
    //        success: function (response) {

    //          //  console.log(response);
    //            console.log(response.data);

    //          //  $("#end_Date_of_Agreement").show();
    //            $("#actual_Rent_End_Date").val(response.data[0].DateAdd);
    //          // alert(response.data[0].DateAdd);
    //          //  alert(response.data[0]["DateAdd"]);



    //        }
    //    })
    //});
    function leapYear(year) {
        return ((year % 4 == 0) && (year % 100 != 0)) || (year % 400 == 0);
    }



    $("#generateAgreement").click(function () {
        $('#submitAgreementIncrement').show();
        $('#generateAgreement').hide();
        $('#slotdatatable').show();
        var actual_Rent_Start_Date = $('#actual_Rent_Start_Date').val();
        var actual_Rent_Start_Date = new Date(actual_Rent_Start_Date);
        var yyyy = parseInt((actual_Rent_Start_Date.getFullYear()).toString());
        var mm = parseInt(((actual_Rent_Start_Date.getMonth() + 1))).toString();
        var dd = (parseInt(actual_Rent_Start_Date.getDate()).toString());
        actual_Rent_Start_Date = (mm + "/" + (dd) + "/" + yyyy);
        var actual_Rent_End_Date = $('#actual_Rent_End_Date').val();
        var actual_Rent_End_Date = new Date(actual_Rent_End_Date);
        var yyyy1 = parseInt((actual_Rent_End_Date.getFullYear()).toString());
        var mm1 = parseInt(((actual_Rent_End_Date.getMonth() + 1))).toString();
        var dd1 = (parseInt(actual_Rent_End_Date.getDate()).toString());
        actual_Rent_End_Date = (mm1 + "/" + (dd1) + "/" + yyyy1);
        var remRent = $('#remRent').val();
        var remTax = $('#remTax').val();
        var leaseExpiry = $('#actual_Rent_Start_Date').val();
        var leaseExpiry = new Date(leaseExpiry);
        var Tenor = parseInt($('#Tenor ').val());
        var increment_Intervale = parseInt($('#increment_Intervale ').val());
        var rent_Pay = parseInt($('#rent_Pay ').val());
        var rent_Increment = parseInt($('#rent_Increment ').val());
        //var ldd = leaseExpiry.substr(0, 2);
        //ldd = parseInt(ldd, 10);
        //var lmm = leaseExpiry.substr(3, 2);
        //lmm = parseInt(lmm, 10);
        //var lyyyy = leaseExpiry.substr(6, 4);
        //lyyyy = parseInt(lyyyy, 10);
        var yyyy = parseInt((leaseExpiry.getFullYear()).toString());
        var mm = parseInt(((leaseExpiry.getMonth() + 1))).toString();
        var dd = (parseInt(leaseExpiry.getDate()).toString());
        var last_day_of_current_month = new Date(yyyy, mm, 0)
        //  alert(last_day_of_current_month);
        var yyyy = parseInt((last_day_of_current_month.getFullYear()).toString());
        var mm = parseInt((last_day_of_current_month.getMonth() + 1)).toString();
        var dd = (parseInt(last_day_of_current_month.getDate()).toString());
        //var first_day_of_next_month = new Date(lyyyy, ldd, 1);
        var first_day_of_next_month = new Date(yyyy, mm, 1);
        var first_day_of_next_month = new Date(yyyy, mm, 1);
        var yyyyf = parseInt((first_day_of_next_month.getFullYear()).toString());
        var mmf = parseInt((first_day_of_next_month.getMonth() + 1)).toString();
        var ddf = (parseInt(first_day_of_next_month.getDate()).toString());


        var last_end_day_of_current_month = (mm + "/" + dd + "/" + yyyy);
        var first_start_day_of_next_month = (mmf + "/" + ddf + "/" + yyyyf);
        //var last_day_of_month = new Date(lyyyy, ldd, 0);
        var last_day_of_month = new Date(yyyy, mm, 0);
        var slot = parseInt(Tenor / increment_Intervale);
        var a = parseInt((first_day_of_next_month.getFullYear()).toString())
        //var res = "";
        //for (i = 0; i <= slot; i++) {

        //    var yyyy = parseInt((a + increment_Intervale).toString());
        //    a = yyyy;

        //    var mm = (first_day_of_next_month.getMonth() + 1).toString();
        //    var dd = first_day_of_next_month.getDate().toString();
        //    var next_Rent_intervale_Date = (mm + "/" + dd + "/" + a);

        //}


        var res = "";
        var eeeres = "";
        var Result = "";
        var Vat = "";
        var firstdate = "";
        var lastday = "";
        var rent_after_increment = "";
        var vat_after_increment = "";
        //var first_day_of_next_month = new Date(lyyyy, ldd, 1);
        var first_day_of_next_month = new Date(yyyy, mm, 1);
        var a = parseInt((first_day_of_next_month.getFullYear()).toString())
        //var last_day_of_month = new Date(lyyyy, ldd, 0);
        var last_day_of_month = new Date(yyyy, mm, 0);
        var l = parseInt((last_day_of_month.getFullYear()).toString())


        var rent_after_increment = parseInt($('#rent_Pay ').val());
        var monthlyRentTaxBased = parseInt($('#monthlyRentTaxBased ').val());

        var c = parseInt((rent_Increment * rent_after_increment) / 100);
        var v = parseInt((rent_Increment * monthlyRentTaxBased) / 100);
        //var l = parseInt((last_day_of_month.getFullYear()).toString())
        if (increment_Intervale == 0) {
            res = $('#actual_Rent_Start_Date ').val();
            eeeres = $('#actual_Rent_End_Date ').val();
            Result = $('#rent_Pay ').val();
            Vat = $('#monthlyRentTaxBased ').val();

        }
        else {
            for (i = increment_Intervale; i < Tenor; i += increment_Intervale) {

                var fyyyy = parseInt((a + increment_Intervale).toString());
                a = fyyyy;

                var lyyyy = parseInt((l + increment_Intervale).toString());
                l = lyyyy;

                var firstmm = (first_day_of_next_month.getMonth() + 1).toString();
                var firstdd = first_day_of_next_month.getDate().toString();


                var lastmm = ((last_day_of_month.getMonth() + 1)).toString();
                var lastdd = last_day_of_month.getDate().toString();


                firstdate = (firstmm + "/" + firstdd + "/" + a);
                lastday = (lastmm + "/" + lastdd + "/" + parseInt(l + increment_Intervale));

                var increment_rent = (rent_after_increment + c);
                rent_after_increment = increment_rent;

                var increment_vat = (monthlyRentTaxBased + v);
                vat_after_increment = increment_vat;
                // alert(monthlyRentTaxBased);

                res += firstdate + ',';
                eeeres += lastday + ',';
                Result += rent_after_increment + ',';
                Vat += vat_after_increment + ',';

                //alert(next_Rent_intervale_Date);
            }
        }


        //var rent_after_increment = parseInt($('#rent_Pay ').val());
        //var c = parseInt((rent_Increment * rent_after_increment) / 100);
        ////var Result = "";
        //for (var i = 0; i <= slot; i++) {
        //    var increment_rent = (rent_after_increment + c);
        //    var rent_after_increment = increment_rent;


        //}



        $.ajax({
            type: "POST",
            url: '/AssetCategory/GetSlotAgreement',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify({
                // first_start_date:first_start_date,
                next_Rent_intervale_Date: res,
                last_day_ofnext_Rent_intervale_Date: eeeres,
                rent_after_increment: Result,
                vat_after_increment: Vat

            }),
            success: function (response) {

                var dateString = response[0].last_day_ofnext_Rent_intervale_Date.substr(6);
                var currentTime = new Date(parseInt(dateString));
                var month = currentTime.getMonth() + 1;
                var day = currentTime.getDate();
                var year = currentTime.getFullYear();
                var date = day + "/" + month + "/" + year;
                //alert("Result" + response);
                if (response != null) {


                    toastr.success(response, 'Agreement', {
                        "closeButton": false,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": true,
                        "positionClass": "toast-top-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "5000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    });
                    var html = '';
                    html += '<tr id="First_row">';
                    html += '<td class="actual_Rent_Start_Date">' + actual_Rent_Start_Date + '</td>';
                    html += '<td>' + last_end_day_of_current_month + '</td>';
                    html += '<td>' + remRent + '</td>';
                    html += '<td>' + remTax + '</td>';
                    html += '</tr>';
                    html += '<tr>';
                    html += '<td>' + first_start_day_of_next_month + '</td>';

                    var rent_date = response[0].last_day_ofnext_Rent_intervale_Date

                    var rent_date = response[0].last_day_ofnext_Rent_intervale_Date
                    //alert(rent_date);
                    var a = new Date(rent_date);
                    // alert(a);
                    var yyyy1 = parseInt((a.getFullYear()));
                    var yyyy = parseInt(yyyy1 - increment_Intervale);

                    var mm = (a.getMonth() + 1).toString();
                    //var dd = a.getDate().toString();

                   // alert(yyyy);
                    var dd = 0;
                    if (mm == '2') {
                        if (leapYear(yyyy)) {
                            dd =  a.getDate();
                        }
                        else {
                            dd = a.getDate() - 1;
                        }
                    } else {
                        dd = a.getDate();
                    }
                    

                    
                    html += '<td>' + (mm + "/" + dd + "/" + yyyy) + '</td>';
                    html += '<td>' + rent_Pay + '</td>';
                    html += '<td>' + monthlyRentTaxBased + '</td>';
                    html += '</tr>';

                    if (increment_Intervale == 0) {
                        for (var i = 1; i < response.length; i++) {

                            //console.log(response[response.length - 1])
                            //console.log(response[response.length - 1].last_day_ofnext_Rent_intervale_Date)
                            html += '<tr>';

                            var last = response[i].last_day_ofnext_Rent_intervale_Date
                            var lastdate = new Date(last);
                            var yyyy = parseInt((lastdate.getFullYear() - increment_Intervale).toString());
                            var mm = (lastdate.getMonth() + 1).toString();
                            var dd = lastdate.getDate().toString();

                            //if (response[response.length - 1].last_day_ofnext_Rent_intervale_Date === response[i].last_day_ofnext_Rent_intervale_Date) {

                            html += '<td>' + response[i].next_Rent_intervale_Date + '</td>';
                            html += '<td>' + actual_Rent_End_Date + '</td>';
                            html += '<td>' + rent_Pay + '</td>';
                            html += '<td>' + monthlyRentTaxBased + '</td>';
                            //} else {
                            //     html += '<td>' + response[i].next_Rent_intervale_Date + '</td>';
                            //    html += '<td>' + response[i].last_day_ofnext_Rent_intervale_Date + '</td>';
                            //    html += '<td>' + response[i].rent_after_increment + '</td>';
                            //     html += '<td>' + response[i].vat_after_increment + '</td>';
                            //}


                            html += '</tr>';

                        }

                        $('#rentalDate').html(html);
                    }
                    else {
                        for (var i = 0; i < response.length; i++) {

                            //console.log(response[response.length - 1])
                            //console.log(response[response.length - 1].last_day_ofnext_Rent_intervale_Date)
                            html += '<tr>';

                            var last = response[i].last_day_ofnext_Rent_intervale_Date
                            var lastdate = new Date(last);
                            var yyyy = parseInt((lastdate.getFullYear() - increment_Intervale).toString());
                            var mm = (lastdate.getMonth() + 1).toString();
                            var dd = lastdate.getDate().toString();

                            if (response[response.length - 1].last_day_ofnext_Rent_intervale_Date === response[i].last_day_ofnext_Rent_intervale_Date) {

                                html += '<td>' + response[i].next_Rent_intervale_Date + '</td>';
                                html += '<td>' + actual_Rent_End_Date + '</td>';
                                html += '<td>' + response[i].rent_after_increment + '</td>';
                                html += '<td>' + response[i].vat_after_increment + '</td>';
                            } else {
                                html += '<td>' + response[i].next_Rent_intervale_Date + '</td>';
                                html += '<td>' + response[i].last_day_ofnext_Rent_intervale_Date + '</td>';
                                html += '<td>' + response[i].rent_after_increment + '</td>';
                                html += '<td>' + response[i].vat_after_increment + '</td>';
                            }


                            html += '</tr>';

                        }

                        $('#rentalDate').html(html);

                    }


                }

            },

            //success: function (result) {
            //    location.reload(true);

            //    $("h2").css({ color: result[1] });
            //},
            error: function () {
                alert("error");
            }
        });
    }
    );

    $("#generateAgreementDetails").click(function () {
        var agreementId = $('#agreementId').val();
        $.ajax({
            type: "POST",
            url: "/AssetCategory/Agreement_increment",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify({
                //  obj: asd
                agreementId: agreementId

            }),
            success: function (response) {

                console.log(response);
                console.log(response.data);

                for (var i = 0; i < response.data.length; i++) {
                    var startDate = response.data[1].Inc_RStrt_Date;
                    var sdate = new Date(startDate);
                    let sformatted_date = sdate.getDate() + "-" + (sdate.getMonth()) + "-" + sdate.getFullYear()
                    var endDate = response.data[1].Inc_REnd_Date;
                    var edate = new Date(endDate);

                    var sMonth = (sdate.getMonth() + 1);
                    var eMonth = (edate.getMonth() + 1);
                    console.log(sMonth + " " + eMonth);

                    var sYear = sdate.getFullYear();
                    var eYear = edate.getFullYear();

                    console.log(sformatted_date + " " + sYear + " " + endDate + " " + eYear);


                    var months = ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"];
                    // var DetailsRow =parseInt(Tenor * 12);
                    // var all = new Array();
                    for (j = sYear; j <= eYear; j++) {

                        //for (var k = 1; k <= months.length; k++) {
                        //    console.log(k);
                        //}

                        $.each(months, function (index, value) {
                            var rent_pay = (Rent_Pay_Date + "-" + value + "-" + j);
                            //alert(rent_pay);
                            //  rent_pay_day = rent_pay;
                            //all[i] = value
                            //month += value + ',';
                            // alert(value);

                            console.log(rent_pay);
                            // alert(month);
                        });
                    }



                }


            }
        })

        var actual_Rent_Start_Date = $('#actual_Rent_Start_Date').val();

        var Rent_Pay_Date = $('#Rent_Pay_Date').val();
        var remRent = $('#remRent').val();
        var leaseExpiry = $('#actual_Rent_Start_Date').val();
        var Tenor = parseInt($('#Tenor ').val());
        var rent_Pay = parseInt($('#rent_Pay ').val());
        var rent_Increment = parseInt($('#rent_Increment ').val());
        var ldd = leaseExpiry.substr(0, 2);
        ldd = parseInt(ldd, 10);
        var lmm = leaseExpiry.substr(3, 2);
        lmm = parseInt(lmm, 10);
        var lyyyy = leaseExpiry.substr(6, 4);
        lyyyy = parseInt(lyyyy, 10);
        var rentPayDate = new Date(lyyyy, ldd - 1, Rent_Pay_Date);
        var increment_Intervale = parseInt($('#increment_Intervale ').val());
        // alert(rentPayDate);
        var actual_Rent_End_Date = $('#actual_Rent_End_Date').val();
        var end_Date = new Date(actual_Rent_End_Date);
        var yyyyf = parseInt((end_Date.getFullYear()).toString());
        var mmf = parseInt((end_Date.getMonth() + 1)).toString();
        var ddf = (parseInt(end_Date.getDate()).toString());



        var month = "";
        var rentAmount = "";
        var Result = "";
        var firstdate = "";
        var lastday = "";
        var rent_pay = "";
        // var increment_rent = "";
        // var rent_after_increment = "";
        var rentPayDate = new Date(lyyyy, ldd - 1, Rent_Pay_Date);
        var a = parseInt((rentPayDate.getFullYear()).toString())
        var m = parseInt((rentPayDate.getMonth() + 1).toString())

        var rent_after_increment = parseInt($('#rent_Pay ').val());
        var c = parseInt((rent_Increment * rent_after_increment) / 100);
        var months = ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"];
        var DetailsRow = parseInt(Tenor * 12);
        var all = new Array();
        for (i = lyyyy; i <= yyyyf; i++) {
            $.each(months, function (index, value) {
                var rent_pay = (Rent_Pay_Date + "-" + value + "-" + i);
                //alert(rent_pay);
                rent_pay_day = rent_pay;
                all[i] = value
                month += rent_pay_day + ',';
                // alert(month);
            });
        }

        console.log(all)

        for (i = 1; i <= DetailsRow; i++) {
            //var increment_rent = (rent_after_increment);
            // alert(rent_after_increment);
            // increment_rent_Amount = increment_rent;
            //rentAmount += increment_rent_Amount + ',';
            // alert(rentAmount);
            //rentAmount += increment_rent_Amount + ',';
            for (i = 3; i < 10; i += 3) {

                console.log()



                //alert(next_Rent_intervale_Date);
            }

        }
        //for (i = increment_Intervale; i < Tenor; i+=increment_Intervale) {

        //   var increment_rent = (rent_after_increment + c);
        //    rent_after_increment = increment_rent;
        //    alert(rent_after_increment);
        //}


    }
    );

    $("#submitAgreementIncrement").click(function () {

        var _Start_Date = "", _End_Date = "", _Increment_Amount = "", _Increment_VAT = "", _VIncrement_Amount = "";

        var ProjectList = $('#ProjectList ').val();
        var UnitList = $('#UnitList').val();
        var agreementId = $('#agreementId').val();
        //$("#rentalDate tr").each(function () {


        //});

        $("#rentalDate").find('tr').each(function () {
            var _r = $(this).find('td:eq(0)').html() + ',';
            var _s = $(this).find('td:eq(1)').html() + ',';
            var _i = $(this).find('td:eq(2)').html() + ',';
            var _v = $(this).find('td:eq(3)').html() + ',';

            _Start_Date += _r;
            _End_Date += _s;
            _Increment_Amount += _i;
            _Increment_VAT += _v;


        });


        //  alert(_rental_ID);
        //alert(_Start_Date);
        //alert(_Increment_Amount);
        if (ProjectList == '') {
            alert('Agreement Id  field is empty !!');
            return false;
        }
        else if (UnitList == '') {
            alert('Contract Type  field is empty!!');
            return false;
        }
        else {
            $.ajax({

                type: "POST",
                url: '/AssetCategory/SaveAgreementIncrement',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                data: JSON.stringify({
                    ProjectList: ProjectList,
                    UnitList: UnitList,
                    agreementId: agreementId,
                    _Start_Date: _Start_Date,
                    _End_Date: _End_Date,
                    _Increment_Amount: _Increment_Amount,
                    _Increment_VAT: _Increment_VAT

                }),
                success: function (response) {
                    //alert("Result" + response);
                    if (response != null) {


                        toastr.success(response, 'Agreement Increment', {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": false,
                            "progressBar": true,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "5000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        });

                        $('.addnew').show();
                        setTimeout(function () {
                            location.reload();
                        }, 5000);
                        // $('#datatable').load(document.URL + ' #datatable');

                    }

                },

                //success: function (result) {
                //    location.reload(true);

                //    $("h2").css({ color: result[1] });
                //},
                error: function () {
                    alert("error");
                }
            });


        }

    });


    $("#ProjectList").change(function () {
        var projectId = $(this).val();

        Unitist(projectId);
    });
    function ProjectList() {

        $.ajax({
            url: '/AssetCategory/RentProjectList',
            type: 'POST',
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (response) {
                if (response.length > 0) {
                    console.log(response);
                    $('select#ProjectList').html('');
                    var result = '';
                    result += "<option value='0'>Project Name</option>";
                    for (var i = 0; response.length > i; i++) {

                        result += "<option id='" + response[i].Project_ID + "'  data-STORAGE_ID='" + response[i].External_ID + "' title='" + response[i].Project_Name + "'value='" + response[i].Project_ID + "'>" + response[i].Project_Name + "</option>";

                    }
                }
                $('select#ProjectList').append(result);


            }
        });
    }

    function Unitist(projectId) {

        $.ajax({
            url: '/AssetCategory/UnitList',
            type: 'POST',
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify({ _projectId: projectId }),
            dataType: "json",
            success: function (response) {
                if (response.length > 0) {
                    console.log(response);
                    $('select#UnitList').html('');
                    var result = '';
                    result += "<option value='0'>Unit Name</option>";
                    for (var i = 0; response.length > i; i++) {
                        if (response[i].UNIT_ID == $('#UnitList_edit').val()) {
                            result += "<option selected value='" + response[i].UNIT_ID + "'>" + response[i].UNIT_NAME + "</option>";
                            //result += "<option selected id='" + response[i].UNIT_ID + "'  data-STORAGE_ID='" + response[i].EXTERNAL_ID + "' title='" + response[i].UNIT_NAME + "'value='" + response[i].UNIT_ID + "'>" + response[i].UNIT_NAME + "</option>";
                        }
                        else {
                            result += "<option id='" + response[i].UNIT_ID + "'  data-STORAGE_ID='" + response[i].EXTERNAL_ID + "' title='" + response[i].UNIT_NAME + "'value='" + response[i].UNIT_ID + "'>" + response[i].UNIT_NAME + "</option>";
                        }


                    }
                }
                $('select#UnitList').append(result);


            }
        });
    }
    function getData() {

        $('#datatable').DataTable({
            "searching": true,
            "paging": true,
            "ordering": true,
            "info": true,
            "language":
            {
                "processing": "<div class='overlay custom-loader-background'><i class='fa fa-cog fa-spin custom-loader-color'></i></div>"
            },
            "processing": true,
            "ajax": {
                "url": "/AssetCategory/AgreementList",
                "type": "GET",
                "datatype": "json"
            },
            "columns": [
                { "data": "External_ID", "autoWidth": true },
                // { "data": "Project_ID", "autoWidth": true },
                { "data": "Project_Name", "autoWidth": true },
                // { "data": "Unit_ID", "autoWidth": true },
                { "data": "UNIT_NAME", "autoWidth": true },
                { "data": "Contract_Type", "autoWidth": true },
                {
                    "data": "Start_DT_Agg", "autoWidth": true,
                    //     title: "Time",
                    //data: "Datetime",
                    render: function (d) {
                        return moment(d).format("DD-MM-YYYY");
                    }

                },
                { "data": "Tenor", "autoWidth": true },
                {
                    "data": "End_DT_Agg", "autoWidth": true,
                    render: function (d) {
                        return moment(d).format("DD-MM-YYYY");
                    }
                },
                { "data": "Advnace_Amt", "autoWidth": true },
                //{ "data": "Rent_Pay", "autoWidth": true },
                //{ "data": "Phone", "autoWidth": true },
                {
                    "data": "Agg_HO_Date", "autoWidth": true,
                    render: function (d) {
                        return moment(d).format("DD-MM-YYYY");
                    }
                },
                // { "data": "Reference_ID", "autoWidth": true },
                {
                    "data": "Act_HO_Date", "autoWidth": true,
                    render: function (d) {
                        return moment(d).format("DD-MM-YYYY");
                    }
                },
                // { "data": "Reference_Contact", "autoWidth": true },
                { "data": "Status", "autoWidth": true },
                {
                    "data": "External_ID", "width": "120px", "render": function (data) {
                        return '<button type="button" class="btn btn-primary" onclick="getProjectUnitView(' + data + ')"><i class="glyphicon glyphicon-eye-open"></i></button>'

                            + '<button type="button" class="btn btn-primary" onclick="editAgreement(' + data + ')"><i class="glyphicon glyphicon-pencil"></i></button>';
                        //return '<button type="button" class="btn btn-primary" onclick="editProject(' + data + ')">Edit</button>';
                        // return '<div class="btn-group"><button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"><li><button type="button" class="btn btn-primary" onclick="getbyID(' + data + ')">DETAIL</button></li><li><button type="button" class="btn btn-info" onclick="getOldCategory(' + data + ')"> OLD CATEGORY</button></li><li><button type="button" class="btn btn-info" onclick="getbyInventoryInsert(' + data + ')">INVENTORY INSERT</button></li><li><button type="button" class="btn btn-warning" onclick="getbyInventoryView(' + data+')">INVENTORY VIEW</button></li></ul></div>';
                    }
                }
            ]
        });

    }
    function getProjectUnitView(projectId) {
        $.ajax({
            type: "POST",
            url: "/AssetCategory/viewUnitDetailsInfo",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify({
                //  obj: asd
                projectId: projectId

            }),
            success: function (response) {
                window.location.href = '/AssetCategory/Unit';
                //window.location.href = ("/AssetChildIndex.cshtml");

            }
        })

    }


    $("#submitAgreement").click(function () {

        //if ($("#projectID").val() == "" || $("#projectName").val() == "" || $("#projectType").val() == "") {

        //    toastr.error('Enter Data', 'Project', {
        //        "closeButton": false,
        //        "debug": false,
        //        "newestOnTop": false,
        //        "progressBar": true,
        //        "positionClass": "toast-top-right",
        //        "preventDuplicates": false,
        //        "onclick": null,
        //        "showDuration": "300",
        //        "hideDuration": "1000",
        //        "timeOut": "5000",
        //        "extendedTimeOut": "1000",
        //        "showEasing": "swing",
        //        "hideEasing": "linear",
        //        "showMethod": "fadeIn",
        //        "hideMethod": "fadeOut"
        //    });
        //    return false;
        //}

        //if ($("#projectName").val() != $("#projectName").val().toUpperCase()) {

        //    toastr.error("Enter Your Project Name Uppercase");
        //    return false;
        //}


        //if ($.trim($("#projectID").val()).length > 5) {
        //    toastr.error('Enter Your Project ID in 5 digit', 'Project ID!', {
        //        "closeButton": false,
        //        "debug": false,
        //        "newestOnTop": false,
        //        "progressBar": true,
        //        "positionClass": "toast-top-right",
        //        "preventDuplicates": false,
        //        "onclick": null,
        //        "showDuration": "300",
        //        "hideDuration": "1000",
        //        "timeOut": "5000",
        //        "extendedTimeOut": "1000",
        //        "showEasing": "swing",
        //        "hideEasing": "linear",
        //        "showMethod": "fadeIn",
        //        "hideMethod": "fadeOut"
        //    });
        //    return false;
        //    //event.preventDefault();
        //}

        //var rowStatus = 1;
        var ProjectList = $('#ProjectList ').val();
        var UnitList = $('#UnitList').val();
        var agreementId = $('#agreementId').val();
        var contractType = $('#contractType ').val();
        var start_Date_of_Agreement = $('#start_Date_of_Agreement').val();
        var Tenor = $('#Tenor ').val();
        var end_Date_of_Agreement = $('#end_Date_of_Agreement ').val();
        var advance_Amount = $('#advance_Amount ').val();
        var rent_Pay = $('#rent_Pay').val();
        var monthlyRentTaxBased = $('#monthlyRentTaxBased ').val();
        var agrement_Hand_Over_Date = $('#agrement_Hand_Over_Date').val();
        var actual_Hand_Over_Date = $('#actual_Hand_Over_Date ').val();
        var rent_Count = $('#rent_Count').val();
        var actual_Rent_Start_Date = $('#actual_Rent_Start_Date').val();
        var actual_Rent_End_Date = $('#actual_Rent_End_Date ').val();
        var actual_Advance_Start_Date = $('#actual_Advance_Start_Date').val();
        var advance_Adjustment_Amount = $('#advance_Adjustment_Amount ').val();
        var notice_Period = $('#notice_Period ').val();
        var aIT_Paid_By = $('#aIT_Paid_By ').val();
        var rent_Increment = $('#rent_Increment').val();
        var increment_Intervale = $('#increment_Intervale').val();
        var payment_Term = $('#payment_Term').val();
        var Rent_Pay_Date = $('#Rent_Pay_Date').val();
        var remRent = $('#remRent').val();
        var remTax = $('#remTax').val();
        var activeStatus = $('#active_status').val();


        if (agreementId == '') {
            alert('Agreement Id  field is empty !!');
            return false;
        }
        else if (contractType == '') {
            alert('Contract Type  field is empty!!');
            return false;
        }
        else {
            //ajax passing data to controller
            $.ajax({


                type: "POST",
                url: '/AssetCategory/SaveAgreement',
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (response) {
                    //alert("Result" + response);
                    if (response != null) {


                        toastr.success(response, 'Agreement', {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": false,
                            "progressBar": true,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "5000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        });
                        $("#agreementId").val("");
                        $("#contractType").val("");
                        $("#Tenor").val("");
                        // $("#active_status").val(-1);
                        $('.addnew').show();
                        setTimeout(function () {
                            location.reload();
                        }, 5000);
                        // $('#datatable').load(document.URL + ' #datatable');

                    }

                },
                data: JSON.stringify({
                    ProjectList: ProjectList,
                    UnitList: UnitList,
                    agreementId: agreementId,
                    contractType: contractType,
                    start_Date_of_Agreement: start_Date_of_Agreement,
                    Tenor: Tenor,
                    end_Date_of_Agreement: end_Date_of_Agreement,
                    advance_Amount: advance_Amount,
                    rent_Pay: rent_Pay,
                    monthlyRentTaxBased: monthlyRentTaxBased,
                    agrement_Hand_Over_Date: agrement_Hand_Over_Date,
                    actual_Hand_Over_Date: actual_Hand_Over_Date,
                    rent_Count: rent_Count,
                    actual_Rent_Start_Date: actual_Rent_Start_Date,
                    actual_Rent_End_Date: actual_Rent_End_Date,
                    actual_Advance_Start_Date: actual_Advance_Start_Date,
                    advance_Adjustment_Amount: advance_Adjustment_Amount,
                    //balanceAdvance:balanceAdvance,
                    notice_Period: notice_Period,
                    aIT_Paid_By: aIT_Paid_By,
                    rent_Increment: rent_Increment,
                    increment_Intervale: increment_Intervale,
                    payment_Term: payment_Term,
                    Rent_Pay_Date: Rent_Pay_Date,
                    remRent: remRent,
                    remTax: remTax,
                    activeStatus: activeStatus

                }),
                //success: function (result) {
                //    location.reload(true);

                //    $("h2").css({ color: result[1] });
                //},
                error: function () {
                    alert("error");
                }
            });
        }

    });


    function editAgreement(agreementId) {
        $.fn.datepicker.defaults.autoclose = true;
        $("#agreementId").prop("disabled", true);
        // $("#ClassList").prop("disabled", true);
        $('.addnew').show();
        //$('#updateAgreement').show();
        $('#submitAgreement').hide();
        $('#submitAgreementIncrement').hide();

        $.ajax({
            type: "POST",
            url: "/AssetCategory/Edit_Agreement",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify({
                //  obj: asd
                agreementId: agreementId

            }),
            success: function (response) {

                console.log(response);
                console.log(response.data);


                $("#agreementId").val(response.data.External_ID);

                $("#ProjectList").val(response.data.Project_ID).trigger('change');
                $("#UnitList_edit").val(response.data.Unit_ID).trigger('change');
                $("#contractType").val(response.data.Contract_Type);
                $("#start_Date_of_Agreement").val(response.data.Start_DT_Agg);
                $("#Tenor").val(response.data.Tenor);
                $("#end_Date_of_Agreement").val(response.data.End_DT_Agg);
                $("#advance_Amount").val(response.data.Advnace_Amt);
                $("#rent_Pay").val(response.data.Rent_Pay);
                $("#monthlyRentTaxBased").val(response.data.M_Rent_Tax_Base);
                $("#agrement_Hand_Over_Date").val(response.data.Agg_HO_Date);
                $("#actual_Hand_Over_Date").val(response.data.Act_HO_Date);
                $("#rent_Count").val(response.data.Rent_Count);
                $("#actual_Rent_Start_Date").val(response.data.Act_RStrt_Date);
                $("#actual_Rent_End_Date").val(response.data.Act_REnd_Date);
                $("#actual_Advance_Start_Date").val(response.data.Act_AdvSrt_Date);
                $("#advance_Adjustment_Amount").val(response.data.Adv_Adjust_Amt);
                $("#notice_Period").val(response.data.Notice_Period);
                $("#aIT_Paid_By").val(response.data.AIT_Paid);
                $("#rent_Increment").val(response.data.Rent_Inc_Perc);
                $("#increment_Intervale").val(response.data.Inc_Interval);
                $("#payment_Term").val(response.data.Payment_Terms);
                $("#Rent_Pay_Date").val(response.data.Rent_Pay_Date);
                $("#remRent").val(response.data.B_M_Rent);
                $("#remTax").val(response.data.B_M_Tax);
                // alert(response.data.Rent_Pay_Date);
                if (response.data.Status == 'Active') {
                    $("#active_status").val('true');
                } else {
                    $("#active_status").val('false');
                }

                $("#btnUpdate").show();


            }
        })


    }


    $("#updateAgreement").click(function UpdateData() {

        // var rowStatus = 2;

        //if ($("#projectName").val() != $("#projectName").val().toUpperCase()) {

        //    toastr.error("Enter Your Project Name Uppercase");
        //    return false;
        //}
        var ProjectList = $('#ProjectList ').val();
        var UnitList = $('#UnitList').val();
        var agreementId = $('#agreementId').val();
        var contractType = $('#contractType ').val();
        var start_Date_of_Agreement = $('#start_Date_of_Agreement').val();
        var Tenor = $('#Tenor ').val();
        var end_Date_of_Agreement = $('#end_Date_of_Agreement ').val();
        var advance_Amount = $('#advance_Amount ').val();
        var rent_Pay = $('#rent_Pay').val();
        var monthlyRentTaxBased = $('#monthlyRentTaxBased ').val();
        var agrement_Hand_Over_Date = $('#agrement_Hand_Over_Date').val();
        var actual_Hand_Over_Date = $('#actual_Hand_Over_Date ').val();
        var rent_Count = $('#rent_Count').val();
        var actual_Rent_Start_Date = $('#actual_Rent_Start_Date').val();
        var actual_Rent_End_Date = $('#actual_Rent_End_Date ').val();
        var actual_Advance_Start_Date = $('#actual_Advance_Start_Date').val();
        var advance_Adjustment_Amount = $('#advance_Adjustment_Amount ').val();
        var notice_Period = $('#notice_Period ').val();
        var aIT_Paid_By = $('#aIT_Paid_By ').val();
        var rent_Increment = $('#rent_Increment').val();
        var increment_Intervale = $('#increment_Intervale').val();
        var payment_Term = $('#payment_Term').val();
        var Rent_Pay_Date = $('#Rent_Pay_Date').val();
        var remRent = $('#remRent').val();
        var remTax = $('#remTax').val();
        var activeStatus = $('#active_status').val();




        if (agreementId == '') {
            alert('Agreement Id  field is empty !!');
            return false;
        }
        else if (contractType == '') {
            alert('Contract Type  field is empty!!');
            return false;
        }
        else {
            //ajax passing data to controller
            $.ajax({
                url: '/AssetCategory/updateAgreement',
                type: 'POST',
                dataType: "json",
                traditional: true,
                success: function (response) {
                    //alert("Result" + response);
                    if (response != null) {


                        toastr.success(response, 'Agreement', {
                            "closeButton": false,
                            "debug": false,
                            "newestOnTop": false,
                            "progressBar": true,
                            "positionClass": "toast-top-right",
                            "preventDuplicates": false,
                            "onclick": null,
                            "showDuration": "300",
                            "hideDuration": "1000",
                            "timeOut": "5000",
                            "extendedTimeOut": "1000",
                            "showEasing": "swing",
                            "hideEasing": "linear",
                            "showMethod": "fadeIn",
                            "hideMethod": "fadeOut"
                        });
                        $("#agreementId").val("");
                        $("#contractType").val("");
                        $("#Tenor").val("");
                        // $("#active_status").val(-1);
                        $('.addnew').show();
                        setTimeout(function () {
                            location.reload();
                        }, 5000);
                        // $('#datatable').load(document.URL + ' #datatable');

                    }

                },
                data: {
                    ProjectList: ProjectList,
                    UnitList: UnitList,
                    agreementId: agreementId,
                    contractType: contractType,
                    start_Date_of_Agreement: start_Date_of_Agreement,
                    Tenor: Tenor,
                    end_Date_of_Agreement: end_Date_of_Agreement,
                    advance_Amount: advance_Amount,
                    rent_Pay: rent_Pay,
                    monthlyRentTaxBased: monthlyRentTaxBased,
                    agrement_Hand_Over_Date: agrement_Hand_Over_Date,
                    actual_Hand_Over_Date: actual_Hand_Over_Date,
                    rent_Count: rent_Count,
                    actual_Rent_Start_Date: actual_Rent_Start_Date,
                    actual_Rent_End_Date: actual_Rent_End_Date,
                    actual_Advance_Start_Date: actual_Advance_Start_Date,
                    advance_Adjustment_Amount: advance_Adjustment_Amount,
                    notice_Period: notice_Period,
                    aIT_Paid_By: aIT_Paid_By,
                    rent_Increment: rent_Increment,
                    increment_Intervale: increment_Intervale,
                    payment_Term: payment_Term,
                    Rent_Pay_Date: Rent_Pay_Date,
                    remRent: remRent,
                    remTax: remTax,
                    activeStatus: activeStatus

                },
                //success: function (response) {

                //    if (response == 'Success') {
                //        location.reload();
                //        //getData();
                //    }
                //},
                error: function () {
                    alert("error");
                }
            });
        }

    });


</script>
