
@{
    ViewBag.Title = "Asset Transfer";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Content/css/select2.css" rel="stylesheet" />
<link href="~/Content/Custom/_Item.css" rel="stylesheet" />
<script src="~/Content/js/select2.full.min.js"></script>
<link href="~/Content/css/bootstrap3-wysihtml5.min.css" rel="stylesheet" />
<link href="~/Content/css/bootstrap-select.css" rel="stylesheet" />
<link href="~/dist/css/bootstrap-datepicker.min.css" rel="stylesheet" />
<script src="~/dist/js/bootstrap-datepicker.min.js"></script>
<link rel="stylesheet" href="~/plugins/iCheck/all.css">
<!-- iCheck 1.0.1 -->
<script src="~/plugins/iCheck/icheck.min.js"></script>

<script src="~/Content/js/bootstrap3-wysihtml5.all.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
<script src="~/Content/js/jquery.dataTables.min.js"></script>
<script src="~/Content/js/dataTables.bootstrap.min.js"></script>


<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>


<style>

    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* The container */
    .container {
        display: block;
        position: relative;
        padding-left: 35px;
        margin-bottom: 12px;
        cursor: pointer;
        font-size: 22px;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }

    /* Hide the browser's default checkbox */
    c.ontainer input {
        position: absolute;
        opacity: 0;
        cursor: pointer;
    }

    /* Create a custom checkbox */
    .checkmark {
        position: absolute;
        top: 0;
        left: 0;
        height: 25px;
        width: 25px;
        background-color: #F03434;
    }

    /* On mouse-over, add a grey background color */
    .container:hover input ~ .checkmark {
        background-color: #ccc;
    }

    /* When the checkbox is checked, add a blue background */
    .container input:checked ~ .checkmark {
        background-color: #2196F3;
    }

    /* Create the checkmark/indicator (hidden when not checked) */
    .checkmark:after {
        content: "";
        position: absolute;
        display: none;
    }

    /* Show the checkmark when checked */
    .container input:checked ~ .checkmark:after {
        display: block;
    }

    /* Style the checkmark/indicator */
    .container .checkmark:after {
        left: 9px;
        top: 5px;
        width: 5px;
        height: 10px;
        border: solid white;
        border-width: 0 3px 3px 0;
        -webkit-transform: rotate(45deg);
        -ms-transform: rotate(45deg);
        transform: rotate(45deg);
    }


    .switch {
        position: relative;
        display: inline-block;
        width: 60px;
        height: 34px;
    }

        .switch input {
            display: none;
        }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        -webkit-transition: .4s;
        transition: .4s;
    }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

    input:checked + .slider {
        background-color: #2196F3;
    }

    input:focus + .slider {
        box-shadow: 0 0 1px #2196F3;
    }

    input:checked + .slider:before {
        -webkit-transform: translateX(26px);
        -ms-transform: translateX(26px);
        transform: translateX(26px);
    }

    /* Rounded sliders */
    .slider.round {
        border-radius: 34px;
    }

        .slider.round:before {
            border-radius: 50%;
        }

    /*.select2-selection__rendered {
        line-height: 32px !important;
    }

    .select2-selection {
        height: 34px !important;
    }*/

</style>

<section class="content-header">
    <h1 style="font-weight: bolder;">
        <span style="font-size: 17px;">Asset<span id="invno" style="color: #428dbd;"></span></span>
        <small>Control panel</small>

    </h1>


    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Asset Item</li>
    </ol>
</section>
<section class="content">
    <!-- Default box -->
    <div class="center-block col-md-6" style="float: none;">    </div>
  
    <div id="myTabContent" class="tab-content form-horizontal">
        <div class="tab-pane fade active in" id="tab_1" color="blue">
            <div id="tab_1_modal" class="form-horizontal">
                <section class="content">
                    <!-- Default box -->
                    <div class="box box-solid">
                      <div class="box-body">
                            <div class="box-group" id="accordion">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h4 class="panel-title" style="color:blue;">
                                            @*<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseOne">*@
                                               Asset Transfer
                                            @*</a>*@
                                        </h4>
                                    </div>
                                    <div id="collapseOne" class="panel-collapse collapse in">
                                        <div class="panel-body" style=" margin-left:10px;width:990px;">
                                            <fieldset>
                                                <legend>Asset </legend>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="hidden">
                                                            <input type="hidden" class="form-control " value="1" id="type_id" placeholder="">
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label for="outletSelect1">Transfer To</label>
                                                            <select type="text" class="form-control select2 outletSelect" id="outletSelect1" name="OutletDefine" style="border-radius:5px; height:30px; margin-right:-5px; width: 220px;"></select>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label for="outletSelect" style="margin-right:150px;">Tran From</label>
                                                            <select type="text" class="form-control select2 outletSelect" id="outletSelect2" name="OutletDefine" style="border-radius:5px; height:30px; margin-right:-5px; width: 220px;"></select>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label for="Order_Date" style="margin-left:5px;">Date</label>
                                                            <div class="input-group date" data-provide="datepicker">
                                                                <input type="text" data-date-format="mm/dd/yyyy" id="Order_Date" class="form-control datepicker " @*placeholder="---Select Date---"*@ autocomplete="off">
                                                                <div class="input-group-addon">
                                                                    <span class="glyphicon glyphicon-th"></span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label for="reason" style="margin-left:15px;">Reason</label>
                                                            <select class="form-control select2" style="border-radius:5px; height:30px; margin-left:5px;" id="ReasonList" name="reason" data-plugin="xin_select" data-placeholder="Model" tabindex="-1" aria-hidden="true"></select>
                                                        </div>

                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="row">
                                                        <div class="col-md-3">
                                                            <label for="ClassList">Class</label>
                                                            <select type="text" class="form-control select2 " style="border-radius:0px; height:50px;width:230px;" id="ClassList"></select>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label for="asset_list">Asset</label>
                                                            <select class="form-control select2" id="asset_list" data-placeholder="Asset"  style="border-radius:5px; height:30px;"></select>
                                                        </div>
                                                        <div class="col-md-3">
                                                            <label for="InitialTag">Initial Tag</label>
                                                            <select type="text" class="form-control select2" style="border-radius:0px;width:230px;" id="InitialTag" data-placeholder="Initial Tag"></select>

                                                        </div>
                                                        <div class="col-md-3">
                                                            <label for="ExternalTag">External Tag</label>
                                                            <select type="text" class="form-control select2" style="border-radius:0px;width:230px;" id="ExternalTag" data-placeholder="External Tag"></select>
                                                        </div>

                                                    </div>
                                                </div>
                                                <div class="text-right">
                                                    <button type="submit" class="btn btn-primary " id="submitAssetTransferData">ADD</button>

                                                </div>
                                                <div class="box box-primary" id="peripheralList" style="margin-top:20px;">
                                                </div>
                                            </fieldset>
                                        </div>
                                       
                                    </div>
                                </div>

                              
                            </div>


                        </div>

                        <!-- /.box -->
                </section>
            </div>
        </div>

    </div>
   
</section>

<script>
   
    $(document).ready(function () {
        $('.select2').select2();
        $.fn.datepicker.defaults.autoclose = true;
         $("#Order_Date").datepicker("setDate", new Date());
        $("#Receive_Date").datepicker("setDate", new Date());
         $("#Efective_Date").datepicker("setDate", new Date());
         $("#Disposed_Date").datepicker("setDate", new Date());
     
        OutletList();
        ClassList();
        ReasonList();
      //  AssetList();
        getPeripheralData();

    });
  function OutletList() {

        $.ajax({
            url: '/AssetCategory/OutletList',
            type: 'POST',
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (response) {

                if (response.length > 0) {
                    $('select#OutletDefine').html('');
                    $('select.outletSelect').html('');
                    // alert("Done");
                    //  console.log(response);
                    var result = '';
                    result += "<option value=''>Select One</option>";
                    for (var i = 0; response.length > i; i++) {
                        if (response[i].Organization_ID == $('#outlet_edit').val()) {

                            result += "<option selected value='" + response[i].Organization_ID + "'>" + response[i].External_ID + " " + response[i].Organization_Name + "</option>";

                        }
                        else {
                            result += "<option  value='" + response[i].Organization_ID + "'>" + response[i].External_ID + " " + response[i].Organization_Name + "</option>";
                        }
                    }
                    $('select#OutletDefine').append(result);
                    $('select.outletSelect').append(result);
                }
            }
        });
    }
  function ClassList() {

        $.ajax({
            url: '/AssetCategory/ClassList',
            type: 'POST',
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (response) {
                if (response.length > 0) {
                    console.log(response);
                    $('select#ClassList').html('');
                    var result = '';
                    result += "<option value='0'>Class Name</option>";
                    for (var i = 0; response.length > i; i++) {

                        result += "<option id='" + response[i].CLASS_ID + "'  data-STORAGE_ID='" + response[i].EXTERNAL_ID + "' title='" + response[i].DESCRIPTION + "' value='" + response[i].CLASS_ID + "' data-shortname='" + response[i].STATUS + "'>" + response[i].DESCRIPTION + "</option>";

                    }
                }
                $('select#ClassList').append(result);


            }
        });
    }
     function ReasonList() {

        $.ajax({
            url: '/AssetCategory/ReasonList',
            type: 'POST',
            contentType: "application/json;charset=utf-8",
            dataType: "json",
            success: function (response) {
                if (response.length > 0) {
                    console.log(response);
                    $('select#ReasonList').html('');
                    var result = '';
                    result += "<option value='0'>Reason Name</option>";
                    for (var i = 0; response.length > i; i++) {

                        result += "<option id='" + response[i].Reason_ID + "'  data-STORAGE_ID='" + response[i].Reason_TypeID + "' title='" + response[i].Reason_Name + "' value='" + response[i].Reason_ID + "' data-shortname='" + response[i].Reason_TypeName + "'>" + response[i].Reason_Name + "</option>";

                    }
                }
                $('select#ReasonList').append(result);


            }
        });
    }
    
    $("#ClassList").change(function () {
        var classId = $(this).val();
       AssetList(classId);
    });
     $("#asset_list").change(function () {
        var asset_list = $(this).val();
         InitialTagList(asset_list);
         ExternalTagList(asset_list);
    });
  function AssetList(classId) {
        $.ajax({
            url: '/AssetCategory/AssetParentList',
            type: 'POST',
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify({ _classId: classId }),
            dataType: "json",
            success: function (response) {

                if (response.length > 0) {
                    $('select#asset_list').html('');

                    var result = '';
                    result += "<option value='0'>Asset Name</option>";
                    for (var i = 0; response.length > i; i++) {

                        result += "<option id='" + response[i].ASSET_CODE + "' data-shortname='" + response[i].ASSET_NAME + "' value='" + response[i].ASSET_CODE + "' data-shortname='" + response[i].ASSET_NAME + "'>" + response[i].ASSET_NAME + "</option>";

                    }

                    $('select#asset_list').append(result);

                }
            }
        });
    }
     function InitialTagList(asset_list) {
        $.ajax({
            url: '/AssetCategory/AssetInitialTagList',
            type: 'POST',
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify({ _asset_list: asset_list }),
            dataType: "json",
            success: function (response) {

                if (response.length > 0) {
                    $('select#InitialTag').html('');

                    var result = '';
                    result += "<option value='0'>Initial Tag</option>";
                    for (var i = 0; response.length > i; i++) {

                        result += "<option  id='" + response[i].ASSET_IDFNO + "' data-shortname='" + response[i].ASSET_INTTAG + "' value='" + response[i].ASSET_IDFNO + "' data-shortname='" + response[i].ASSET_EXTTAG + "'>" + response[i].ASSET_INTTAG + "</option>";

                    }

                    $('select#InitialTag').append(result);

                }
            }
        });
    }
     function ExternalTagList(asset_list) {
        $.ajax({
            url: '/AssetCategory/AssetExternalTagList',
            type: 'POST',
            contentType: "application/json;charset=utf-8",
            data: JSON.stringify({ _asset_list: asset_list }),
            dataType: "json",
            success: function (response) {

                if (response.length > 0) {
                    $('select#ExternalTag').html('');

                    var result = '';
                    result += "<option value='0'>External Tag</option>";
                    for (var i = 0; response.length > i; i++) {

                        result += "<option  id='" + response[i].ASSET_IDFNO + "' data-shortname='" + response[i].ASSET_EXTTAG + "' value='" + response[i].ASSET_IDFNO + "' data-shortname='" + response[i].ASSET_EXTTAG + "'>" + response[i].ASSET_EXTTAG + "</option>";

                    }

                    $('select#ExternalTag').append(result);

                }
            }
        });
    }
    $("#submitAssetTransferData").click(function () {
        
           if ($("#asset_list").val() == "" || $("#InitialTag").val() == "" || $("#ExternalTag").val() == "") {

            toastr.error('Enter Data', 'Asset Transfer', {
                "closeButton": false,
                "debug": false,
                "newestOnTop": false,
                "progressBar": true,
                "positionClass": "toast-top-right",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            });
            return false;
        }

        //if ($("#asset_list").val() != '') {

        //    toastr.error("Select Asset Name");
        //    return false;
        //}
        //  if ($("#InitialTag").val() != '') {

        //    toastr.error("Select Initial Tag");
        //    return false;
        //}
        //  if ($("#ExternalTag").val() != '') {

        //    toastr.error("Select External Tag");
        //    return false;
        //}

        var Asset = $('#asset_list ').val();
        var InitialTag = $('#InitialTag ').val();
        var ExternalTag = $('#ExternalTag ').val();
      
        //ajax passing data to controller
        $.ajax({

            type: "POST",
            url: '/Department/SaveAssetTransfer',
            contentType: "application/json; charset=utf-8",
            dataType: "json",

            data: JSON.stringify({
                Asset: Asset,
                initialTag: InitialTag,
                externalTag: ExternalTag
                
            }),
            success: function (response) {
               
                if (response != null) {

                    toastr.success(response, 'Asset', {
                        "closeButton": false,
                        "debug": false,
                        "newestOnTop": false,
                        "progressBar": true,
                        "positionClass": "toast-top-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "300",
                        "hideDuration": "1000",
                        "timeOut": "5000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    });

                        $("#asset_list").val("");
                        $("#InitialTag").val("");
                        $("#ExternalTag").val("");
                     
                   
                    $('.addnew').show();
                 
                    getPeripheralData();

                    //$('#collapseSix').addClass('in');
                    //$('#collapseSix').attr('aria-expanded','true');
                }

            },
              error: function () {
                alert("error");
            }
        });


    });

      function getPeripheralData() {
        //ajax passing data to controller


        $.ajax({

            type: "GET",
            url: '/AssetCategory/TransGridList',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (response) {
               
                //alert("Result" + response);
                if (response != null) {

                    $('#peripheralList').empty();

                    var result = '';
                     if (response.data.length > 0) {
                                            
                                                result += '<div class="col-md-12">';
                                                result += '<div class="box-body table-responsive no-padding" id="peripheraldatatableload">';
                                                result += '<table id="peripheraldatatable" class="table table-bordered table-striped compact hover" cellspacing="0" width="100%">';
                                                result += '<thead>';
                                                result += '<tr>';
                                                result += '<th style="text-align:center;">Aseet</th>';
                                                result += '<th style="text-align:center;">Initial Tag</th>';
                                                result += '<th style="text-align:center;">External Tag</th>';
                                                result += '<th style="text-align:center;">Stock QTY</th>';
                                                result += '<th style="text-align:center;">Req QTY</th>';
                                                result += '<th style="text-align:center;">Cost</th>';
                                                result += '<th style="text-align:center;">Tax</th>';
                                                result += '<th style="text-align:center;">Sub Total</th>';
                                                result += '<th style="text-align:center;">Actions</th>';
                                                result += '</tr>';
                                                result += '</thead>';
                                                result += '<tbody>';

                                                 for (var i = 0; i < response.data.length; i++) {


                                                     result += '<tr id="'+ response.data[i].ASSET_CODE +'">';
                                                     result += '<td style="text-align:center;"> ' + response.data[i].MAIN_ASSET + '</td>';
                                                     result += '<td style="text-align:center;"> ' + response.data[i].ASSET_INTTAG + '</td>';
                                                     result += '<td style="text-align:center;"> ' + response.data[i].ASSET_EXTTAG + '</td>';
                                                     result += '<td style="text-align:center;"> ' + response.data[i].TOTAL_ASSET + '</td>';
                                                     result += '<td>  <input type="text" id="req_qty" name="row-7-position" value="Request Quantity" style="text-align:center;" /> </td>';
                                                     result += '<td style="text-align:center;"> ' + response.data[i].P_COST + '</td>';
                                                     result += '<td style="text-align:center;"> '+ response.data[i].TAX  + '</td>';
                                                     result += '<td style="text-align:center;"> ' + response.data[i].SUB_TOTAL + '</td>';
                                                     //result += '<td style="text-align:center;"> '  + '</td>';
                                                     result += '<td style="text-align:center;"> <button type="button" class="btn btn-primary" onclick="deleteAssetPeripheral(' + response.data[i].ASSET_CODE + ')">Delete</button></td>';
                                                     result += '</tr>';

                                                 }
                                                result += '</tbody>';
                                                result += '</table>';
                                                result += '</div>';
                                                result += '</div>';
                                            }
                    $('#peripheralList').append(result);
                }

            },
            //success: function (result) {
            //    location.reload(true);

            //    $("h2").css({ color: result[1] });
            //},
            error: function () {
                alert("error");
            }
        });
    }


</script>

<link href="~/Content/Custom/_AssetMaster.css" rel="stylesheet" />